var app=angular.module("app",["ngTouch","ui.grid","ngSanitize"]),Pr,PC;app.factory("projectControlService",function(n){var t={};return t.GetWorkOrder=function(){return n({method:"GET",dataType:"jsonp",url:"api/projectControl/getWorkOrder"})},t.GetProjectStatus=function(){return n({method:"GET",dataType:"jsonp",url:"api/projectControl/getProjectStatus"})},t.GetTypeRequest=function(){return n({method:"GET",dataType:"jsonp",url:"api/projectControl/getTypeRequest"})},t});app.controller("GridCtrl",function(n,t,i){n.alertType="info";n.loadigMessage="<p>Loading data, please wait...!<\/p>";n.GetProjects=function(){n.typeRequest=null;n.projectStatus=null;n.dataLoaded=!1;n.gridOptions={onRegisterApi:function(t){n.gridApi=t;n.gridApi.grid.registerRowsProcessor(n.searchFilter,1e4)},columnDefs:[{field:"projectName",name:"Project"},{field:"idTypeRequest",name:"Request Type",cellFilter:"getTypeRequest:grid.appScope.typeRequest"},{field:"date",type:"date",cellFilter:"date:'MMM dd yyyy'"},{field:"prodigiousPM",name:"Prodigious PM"},{field:"idProjectStatus",name:"Status",cellFilter:"getStatusType:grid.appScope.projectStatus"},{name:"View",width:100,cellTemplate:'<div class="ui-grid-cell-contents"><a href="/workorder/view/{{ row.entity.uniqueId }}/{{ row.entity.secureCode }}"><i class="fa fa-link"><\/i><\/a><\/div>'},{name:"Update",width:100,cellTemplate:'<div class="ui-grid-cell-contents grid-update"><a href="/workorder/update/{{ row.entity.uniqueId }}/{{ row.entity.secureCode }}"><i class="fa fa-edit"><\/i><\/a><\/div>'}]};i.GetTypeRequest().then(function(t){n.typeRequest=[];var i=t.data;i.forEach(function(t){n.typeRequest[t.uniqueId]=t.request})},function(){n.loadigMessage==="<p>Loading data, please wait...!<\/p>"&&(n.loadigMessage="");n.alertType="danger";n.loadigMessage=n.loadigMessage+"<p>Error loading TypeRequest Table from the Data Base. <strong>Please check the Data Base connection<\/strong><\/p>"});i.GetProjectStatus().then(function(t){n.projectStatus=[];var i=t.data;i.forEach(function(t){n.projectStatus[t.uniqueId]=t.status})},function(){n.loadigMessage==="<p>Loading data, please wait...!<\/p>"&&(n.loadigMessage="");n.alertType="danger";n.loadigMessage=n.loadigMessage+"<p>Error loading ProjectStatus Table from the Data Base. <strong>Please check the Data Base connection<\/strong><\/p>"});i.GetWorkOrder().then(function(t){n.dataLoaded=!0;n.gridOptions.data=t.data},function(){n.loadigMessage==="<p>Loading data, please wait...!<\/p>"&&(n.loadigMessage="");n.alertType="danger";n.loadigMessage=n.loadigMessage+"<p>Error loading WorkOrder Table from the Data Base. <strong>Please check the Data Base connection<\/strong><\/p>"})};n.GetProjects()}).filter("getTypeRequest",function(){return function(n,t){return t[n]}}).filter("getStatusType",function(){return function(n,t){return t[n]}});Pr=Pr||{};Pr.preferences={moveItems:function(n,t){$(n).find(":selected").appendTo(t)},moveAllItems:function(n,t){$(n).children().appendTo(t)},init:function(){$("#left").click(function(){Pr.preferences.moveItems("#assetsDestination","#assetsOring")});$("#right").on("click",function(){Pr.preferences.moveItems("#assetsOring","#assetsDestination")})}};Pr.preferences.init();Pr.form={init:function(){alert("Preferences updated!")}};Pr.SelectedIndexChanged={init:function(){var n=$("#TypeRequest :selected").text();alert("On changed!"+n)}};PC=PC||{};PC.workOrder={_prop:{},domainBtn:function(){var n=$("#domains-inputs"),r=$("#btn-domains"),t=$("#newDomain"),i=n.data("count");$(r).click(function(r){r.preventDefault();$(n).append('<div><input name="Domains['+i+'].domain1" type="text" class="form-control" placeholder="URL" value="'+t.val()+'" /><\/div>');t.val("");i++})},targetDeviceBnt:function(){var t=$("#targetDeviceList"),i=$("#btn-target-device"),n=$("#newTargetDevice");$(i).click(function(i){i.preventDefault();const r=n.val().toLowerCase().replace(" ","-"),u='<li id="'+r+'"><span>'+n.val()+'<\/span><button onclick="PC.workOrder.Remove('+r.toString()+')" class="btn btn-primary"><i class="fa fa-times"><\/i><\/button><\/li>';$(t).append(u);n.val("");PC.workOrder.Update()})},urlAffectedBtn:function(){var n=$("#urlAffected-inputs"),r=$("#btn-urlAffected"),t=$("#newUrlAffected"),i=n.data("count");$(r).click(function(r){r.preventDefault();$(n).append('<div><input name="EffectedUrls['+i+'].url" type="text" class="form-control" placeholder="URL" value="'+t.val()+'" /><\/div>');t.val("");i++})},thirdPartyURL:function(){var t=$("#thirdParty-inputs"),f=$("#btn-thirdParty"),i=$("#newThirdPartyUrl"),r=$("#newThirdPartyUser"),u=$("#newThirdPartyPass"),n=t.data("count");$(f).click(function(f){f.preventDefault();var e='<div><input name="ThirdPartyCredential['+n+'].url" type="text" class="form-control" placeholder="URL" value="'+i.val()+'" />';e+='<input name="ThirdPartyCredential['+n+'].userName" type="text" class="form-control" placeholder="User" value="'+r.val()+'" />';e+='<input name="ThirdPartyCredential['+n+'].passPCrd" type="text" class="form-control" placeholder="PassPCrd" value="'+u.val()+'" /><\/div>';$(t).append(e);i.val("");r.val("");u.val("");n++})},getWorkOrderId:function(n){const t=n.baseURI.split("/");return parseInt(t[5])},sendEmail:function(n,t){$.ajax({url:"/WorkOrder/SendEmail",type:"POST",data:`{ 'idWorkOrder': '${n}', 'url': '${t}' }`,dataType:"text",contentType:"application/json; charset=utf-8",success:function(){console.log("email send")},error:function(n){console.log(n)}})},Update:function(){const n=PC.workOrder._prop.targetList.children();var t="";for(let i=0;i<n.length;i++)t+=n[i].innerText+";";PC.workOrder._prop.targetDevice.val(t)},OnSuccess:function(n){$("html, body").animate({scrollTop:0},"fast");PC.workOrder._prop.workOrderResult.removeClass("hide");PC.workOrder.sendEmail(PC.workOrder.getWorkOrderId(n.context),n.context.baseURI)},OnComplete:function(n){const t=n.context.ownerDocument.activeElement.value,i=n.context.baseURI.replace("update","generatepdf");t==="ExportPdf"&&(window.location.href=i)},Remove:function(n){n.remove();PC.workOrder.Update()},setSelector:function(){PC.workOrder._prop.referenceJob=$("#referenceJob");PC.workOrder._prop.targetDevice=$("#targetDevice");PC.workOrder._prop.targetList=$("#targetDeviceList");PC.workOrder._prop.workOrderResult=$("#workOrderResult");PC.workOrder._prop.referencePreviousJob=$("#referencePreviousJob")},init:function(){PC.workOrder.setSelector();PC.workOrder.domainBtn();PC.workOrder.targetDeviceBnt();PC.workOrder.urlAffectedBtn();PC.workOrder.thirdPartyURL();$(document).ready(function(){if(PC.workOrder._prop.targetDevice.val()){const n=PC.workOrder._prop.targetDevice.val().split(";");n.forEach(function(n){if(n!==""){const t=n.toLowerCase().replace(" ","-"),i='<li id="'+t+'"><span>'+n+'<\/span><button onclick="PC.workOrder.Remove('+t.toString()+')" class="btn btn-primary"><i class="fa fa-times"><\/i><\/button><\/li>';PC.workOrder._prop.targetList.append(i)}})}PC.workOrder._prop.referencePreviousJob.val()&&$.ajax({url:"/WorkOrder/GetProjectName",data:`{ 'id': '${PC.workOrder._prop.referencePreviousJob.val()}'}`,dataType:"json",type:"POST",contentType:"application/json; charset=utf-8",success:function(n){PC.workOrder._prop.referenceJob.is("div")?PC.workOrder._prop.referenceJob.text(n.shift().ProjectName):PC.workOrder._prop.referenceJob.val(n.shift().ProjectName)}});PC.workOrder._prop.referenceJob.autocomplete({source:function(n,t){$.ajax({url:"/WorkOrder/AutoComplete",data:`{ 'prefix': '${n.term}'}`,dataType:"json",type:"POST",contentType:"application/json; charset=utf-8",success:function(n){t($.map(n,function(n){return{label:n.ProjectName,value:n.ProjectName,idPN:n.UniqueId}}))}})},select:function(n,t){PC.workOrder._prop.referencePreviousJob.val(t.item.idPN)},minLength:1})})}};PC.workOrder.init();